# –î–ï–ú–û –≠–∫–∑–∞–º–µ–Ω

# –ù–æ–≤—ã–µ IP –∞–¥—Ä–µ—Å–∞


---


:::warning
–ù–∞ —ç–∫–∑–∞–º–µ–Ω–µ –∏—Ö –º–æ–≥—É—Ç —Å–Ω–æ–≤–∞ —Å–º–µ–Ω–∏—Ç—å, –ø–æ —ç—Ç–æ–º—É –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏—Ö –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —ç–∫–∑–∞–º–µ–Ω–µ

:::


:::warning
–í –º–µ—Ç–æ–¥–∏—á–∫–µ —É–∫–∞–∑–∞–Ω—ã —Å—Ç–∞—Ä—ã–µ IP –∞–¥—Ä–µ—Å–∞, –ø–æ —ç—Ç–æ–º—É –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—Å—ë –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥—ã **(–º–æ–∂–µ—Ç–µ –æ—Ä–µ–∏–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –Ω–æ–º–µ—Ä—É –º–∞—Å–∫–∏)**

:::

| **HQ_RTR:** |    |
|----|----|
|     172.16.4.1/28 | ISP |
|     192.168.0.62/26 | HQ_SRV |
|     10.5.5.1/30 | –¢—É–Ω–Ω–µ–ª—å —Å BR_RTR |
|     192.168.0.78 | HQ_CLI |
| 
--- | 
--- |
| **HQ_SRV:** | 192.168.0.1/26 |
| **HQ_CLI:** | 192.168.0.68/28 |
| 
--- | 
--- |
| **BR_RTR:** |    |
|     10.5.5.2/30 | –¢—É–Ω–Ω–µ–ª—å —Å HQ_RTR |
|     172.16.5.1/28 | ISP |
|     192.168.1.30/27 | BR_SRV |
| 
--- | 
--- |
| **BR_SRV:** | 192.168.1.1/27 |
| 
--- | 
--- |
| **ISP:** |    |
| 172.16.4.14/28 | HQ |
| 172.16.5.14/28 | BR |


\
# –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ—Ç–æ–¥–∏—á–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞/–∫–ª–∏–µ–Ω—Ç–∞/—Ä–æ—É—Ç–µ—Ä–∞


---

–¢–∞–∫ –∫–∞–∫ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å–ª–∏—à–∫–æ–º "–ø–∞–ª–µ–≤–Ω–æ", –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –≤–∞—Ä–∏–∞–Ω—Ç —Å –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.


## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Proxmox


---

–î–ª—è –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã, –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –æ–∫–Ω–µ, –¥–ª—è —ç—Ç–æ–≥–æ –¥–≤–∞–∂–¥—ã –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –≤ Proxmox.

–ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ —è –¥–≤–∞–∂–¥—ã –Ω–∞–∂–∞–ª –Ω–∞ `101 (edu-docker)` –∏ —É –º–µ–Ω—è –æ—Ç–∫—Ä—ã–ª–∞—Å—å –µ–≥–æ –∫–æ–Ω—Å–æ–ª—å –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ.

 ![](attachments/7af2e4c0-00b6-4ec2-9de8-d539e57c2fb9.png " =634x506.5")

–≠—Ç–æ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ –∫–æ–≥–¥–∞ –≤—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∞—à–∏–Ω.


## –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞ —Å –º–µ—Ç–æ–¥–∏—á–∫–æ–π


---

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª —Å –º–µ—Ç–æ–¥–∏—á–∫–æ–π, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:


# 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä Samba –Ω–∞ –º–∞—à–∏–Ω–µ BR-SRV.

## –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Samba AD:


---

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª /etc/named.conf:

```commandline
nano /etc/named.conf
```

–í–Ω–µ—Å–∏—Ç–µ –≤ –±–ª–æ–∫ `options`, —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –¥–æ–±–∞–≤–∏–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```co
 listen-on port 53 { 192.168.1.2; };  
 allow-query { any; };  
 dnssec-validation no;  
 tkey-gssapi-keytab "/var/lib/samba/bind-dns/dns.keytab";  
 minimal-responses yes;  
 forwarders { 8.8.8.8; };  
```

 ![](attachments/07270ffe-502a-4900-99fb-3533a673efd5.png)


## –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Samba


---

–£–¥–∞–ª—è–µ–º smb.conf –∏ –¥—Ä—É–≥–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É:

```shell
rf -f /etc/samba/smb.conf
rm -rf /var/lib/samba
rm -rf /var/cache/samba
mkdir -p /var/lib/samba/sysvol
```

–ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É

```shell
samba-tool domain provision --use-rfc2307 --interactive
```

–ó–∞–¥–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫—Ä–æ–º–µ:

* DNS Backend: `NONE` (–Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –Ω–µ–≤–µ—Ä–Ω–æ)
* Administrator password: `P@ssw0rd`
* Retype password: `P@ssw0rd`

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∫–∞–∂–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–º–µ–Ω–∞.  ![](attachments/b1b86d2e-9493-4946-bac8-c9ed4e3fd357.png)  ![](attachments/187d2654-1c8b-47f4-8f0b-dd3d4d4c6d06.png)

–ó–∞—Ö–æ–¥–∏–º –≤ smb.conf –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ —Å–∞–º—ã–π –∫–æ–Ω–µ—Ü –ø–µ—Ä–≤–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞:

```bash
nano /etc/samba/smb.conf
```

```ini
Dns forwarder = 192.168.0.1
```

–ó–∞–ø—É—Å–∫–∞–µ–º samba –∏ bind —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É.

```shell
systemctl enable --now samba
systemctl enable --now bind
```

–ü—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—É:

```bash
Cp /var/lib/samba/private/krb5.conf /etc/krb5.conf
```


## –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥—Ä—É–ø–ø—É –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è


---

C–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ–º–µ–Ω–∞:

```shell
samba-tool group add hq
```

C–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```shell
samba-tool user create user1.hq "P@ssw0rd" --home-directory=/home/AU-TEAM/user1.hq --uid=user1.hq
```

–î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É

```shell
samba-tool group addmembers hq user1.hq
samba-tool group addmembers hq user2.hq
samba-tool group addmembers "Account Operators" hq
samba-tool group addmembers "Allowed RODC Password Replication Group" hq
```

 ![](attachments/65337250-e0ad-4540-a742-e25702be562c.png)

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º samba

```bash
systemctl restart samba
```


:::warning
**–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä–≤–µ—Ä!!!**

```bash
reboot
```

:::


## –í–≤–æ–¥–∏–º –≤ –¥–æ–º–µ–Ω hq-cli


---

–û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª, —á–µ—Ä–µ–∑ `CTRL+ALT+T`, –∏–ª–∏ –º–µ–Ω—é –≤ –ª–µ–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É —ç–∫—Ä–∞–Ω–∞.

–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ `resolv.conf`

```pro
su -
nano /etc/resolv.conf
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∞–¥—Ä–µ—Å DNS —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ Samba AD:

```properties
search au-team.irpo
nameserver 192.168.3.1
```

 ![](attachments/fc29af09-8644-48b7-b241-1796e4037354.png)

–°–æ—Ö—Ä–∞–Ω—è–µ–º `CTRL + O` –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞  `CTRL + X`

–ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É

```bash
reboot
```

–î–∞–ª–µ–µ –≤–≤–æ–¥–∏–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –¥–æ–º–µ–Ω:

```bash
Realm join -U user1.hq au-team.irpo
```


:::info
–ó–∞–ø—è—Ç—ã–µ –≤ –∫–æ–º–∞–Ω–¥–µ - —ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞

`-U` - **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã.

:::


–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª–∫—É –∫–ª–∏–µ–Ω—Ç–∞ –∏ –≤—Ö–æ–¥–∏–º –ø–æ–¥ –¥–æ–º–µ–Ω–Ω–æ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é: ![](attachments/1c3df4d0-0d00-4df5-b7f9-9f83347abebf.png)

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª.


## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (—á–µ—Ä–µ–∑ sudo):


---

–û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª, –≤—Ö–æ–¥–∏–º –Ω–∞ HQ-CLI –ø–æ–¥ —Ä—É—Ç–æ–º –∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É Echo –≤–ø–∏—Å—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `/etc/sudoers.d/hq`:

```shell
su -
Echo "%hq ALL=(ALL) NOPASSWD:/bin/cat,/bin/grep,/usr/bin/id" > /etc/sudoers.d/hq
```

### –ò–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ BR-SRV:

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:

```shell
nano /opt/import_users.sh
```

–ü–∏—à–µ–º

```shell
#!/bin/bash
CSV_FILE="/opt/users.csv"
 while IFS=, read -r username password group; do
  # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     samba-tool user create "$username" "$password" --home-directory="/home/$username" --uid="$username"
      # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
     samba-tool group addmembers "$group" "$username"
done < "$CSV_FILE" 
```

 ![](attachments/712f1086-9361-4de0-950e-360b3537ad87.png)

–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```shell
chmod +x /opt/import_users.sh
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ:

```shell
/opt/import_users.sh
```


# 2. –°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:


---

–í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¥–∏—Å–∫–æ–≤ –∏ –∏—Ö –∏–º–µ–Ω–∞.

```shell
lsblk
```

 ![](attachments/acb124e3-666c-44b1-b455-6f9b66f2f2ff.png)

## –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–¥–µ–ª–æ–≤


---

–î–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –¥–∏—Å–∫–∞, –∑–∞–ø—É—Å–∫–∞–µ–º fdisk —Å –∏–º–µ–Ω–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:

```shell
fdisk /dev/sdb
```

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã: –í–≤–æ–¥–∏–º `g` —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø—É—Å—Ç—É—é —Ç–∞–±–ª–∏—Ü—É —Ä–∞–∑–¥–µ–ª–æ–≤:

```shell
Command (m for help): g
```

–í–≤–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É `n` —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª:

```shell
Command (m for help): n
```

–ë—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä —Ä–∞–∑–¥–µ–ª–∞.

* –ñ–º–µ–º ¬´Enter¬ª, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (1)

–î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—ã–π —Å–µ–∫—Ç–æ—Ä.

* –ñ–º–µ–º ¬´Enter¬ª, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä.

* –ñ–º–µ–º ¬´Enter¬ª, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å –¥–∏—Å–∫

 ![](attachments/e971fd2f-340b-4025-9935-1b036cfe8f33.png)

–°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∑–∞–ø—É—Å—Ç–∏–≤ –∫–æ–º–∞–Ω–¥—É `w`

```shell
Command (m for help): w
```

–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø–∏—à–µ—Ç —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –¥–∏—Å–∫ –∏ –≤—ã–π–¥–µ—Ç –∏–∑ –º–µ–Ω—é `fdisk`.–Ø–¥—Ä–æ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Ä–∞–∑–¥–µ–ª–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã.–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–æ–∑–¥–∞–µ–º —Ä–∞–∑–¥–µ–ª—ã –Ω–∞ –¥—Ä—É–≥–∏—Ö –¥–∏—Å–∫–∞—Ö `/dev/sdc`, `/dev/sdd`

 ![](attachments/8cc96668-9b4b-4e6c-9fdf-2bed23b03236.png)

## –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ RAID5

–î–ª—è —Å–±–æ—Ä–∫–∏ –º–∞—Å—Å–∏–≤–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:

```shell
mdadm --create --verbose /dev/md0 -l 5 -n 3 /dev/sdb1 /dev/sdc1 /dev/sdd1
```

–°–∏—Å—Ç–µ–º–∞ –∑–∞–¥–∞—Å—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å, —Ö–æ—Ç–∏–º –ª–∏ –º—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å RAID ‚Äî –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å `y`: –ú—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –Ω–∞ –ø–æ–¥–æ–±–∏–∏:  ![](attachments/5aac417f-0d84-4960-93d9-1c53412f6c5a.png)

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö RAID –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:

```shell
cat /proc/mdstat
```

 ![](attachments/518f6e52-8bb0-4b57-952f-73df5fc0c94a.png)

## –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –º–∞—Å—Å–∏–≤–∞

–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–¥–µ–ª—ã –≤ ext4:

```shell
mkfs.ext4 /dev/md0
```

 ![](attachments/fcf02882-f9f8-486b-be68-563e93031636.png)

–í –∫–æ—Ä–Ω–µ —Å–∏—Å—Ç–µ–º—ã —Å–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /raid5

```shell
mkdir /raid5
```

–ü—Ä–∏–º–æ—Ç–∏—Ä—É–µ–º –∫ RAID –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /raid5 –∫–æ–º–∞–Ω–¥–æ–π:

```shell
mount /dev/md0 /raid5
```

–ß—Ç–æ–±—ã —Ä–∞–∑–¥–µ–ª—ã –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã –û—Ç–∫—Ä—ã–≤–∞–µ–º fstab:

```shell
nano /etc/fstab
```

–ò –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏

```shell
/dev/md0    /raid5    ext4    defaults    0    0
```

 ![](attachments/7e1d71be-15bb-4cf9-a66b-2c93c9d74bc7.png)

–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:

```shell
df -h
```


## –°–µ—Ä–≤–µ—Ä NFS

–°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ `/raid5/nfs`

```shell
mkdir /raid5/nfs
```

–ó–∞–ø—É—Å–∫–∞–µ–º nfs —Å–µ—Ä–≤–µ—Ä:

```shell
systemctl enable -- now nfs
```

–û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª `/etc/exports` –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞—Ç–∞–ª–æ–≥–∞—Ö, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞:

```shell
nano /etc/exports
```

–°–æ–∑–¥–∞–µ–º —à–∞—Ä—É –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `/raid5/nfs`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤ —Å–µ—Ç–∏ `192.168.0.64/27` –î–æ–±–∞–≤–∏–º –≤ –Ω–µ–≥–æ —Å—Ç—Ä–æ–∫—É:

```shell
/raid5/nfs 192.168.0.64/27(rw,subtree_check)
```

–í—ã–ø–æ–ª–Ω—è–µ–º —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (–ø–µ—Ä–µ—á–∏—Ç–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª /etc/exports, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –Ω–∞—á–∞–ª –æ—Ç–¥–∞–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —à–∞—Ä—ã):

```shell
exportfs -a
```

### –ê–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–∞ HQ-CLI —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏ NFS: –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `/mnt/nfs`

```shell
mkdir /mnt/nfs
```

–ü—Ä–æ–±—É–µ–º –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞—Ä—É:

```shell
mount -t nfs 192.168.100.2:/raid5/nfs /mnt/nfs
```

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ HQ-CLI –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º `fstab`. –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª `fstab`:

```shell
nano /etc/fstab
```

–ò –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É:

```shell
192.168.0.2:/raid5/nfs        /mnt/nfs    nfs     auto    0 0
```

 ![](attachments/f5422c9f-76f6-40fc-a8f5-0b111ac1310c.png)

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É —Å–µ—Ç–µ–≤—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É NTP

–ó–∞—Ö–æ–¥–∏–º –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `chrony.conf`

```shell
nano /etc/chrony.conf
```

–ü—Ä–∏–≤–æ–¥–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–∏–¥—É IP-–∞–¥—Ä–µ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å!:

```toml
server 127.0.0.1 iburst prefer
local stratum 5
allow 192.168.0.0/26
allow 192.168.0.64/27
allow 192.168.0.96/29
allow 192.168.3.0/27
```

 ![](attachments/fe627f6f-a5e2-40a2-bef3-317794be7523.png)

–°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –∏ –≤—ã—Ö–æ–¥–∏–º. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```shell
systemctl enable --now chronyd
```

 ![](attachments/f21aad83-3b5b-4764-ae09-597924f9bb5d.png)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NTP –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ hq-srv br-rtr, br-srv, hq-cli.

–ó–∞—Ö–æ–¥–∏–º –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª "chrony.conf"

```shell
nano /etc/chrony.conf
```

–ü—Ä–∏–≤–æ–¥–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–∏–¥—É IP-–∞–¥—Ä–µ—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å!:

```toml
server 192.168.1.62 iburst prefer
```


\
–°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –∏ –≤—ã—Ö–æ–¥–∏–º.–ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

```shell
systemctl enable --now chronyd
```

 ![](attachments/be9cd7f1-0d82-45b9-baa1-aa4e17a7e311.png)

–ü—Ä–æ–≤–µ—Ä—è–µ–º

```shell
chronyc sources
```

 ![](attachments/cebab6bf-4e11-4ba1-8d8c-291a849c30f6.png)

–û—Å—Ç–∞–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å hq-srv.

# 4. –°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ ansible –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ BR-SRV

## –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—ã SSH-–∫–ª—é—á–µ–π. 

–ß—Ç–æ–±—ã –∑–∞—Ö–æ–¥–∏—Ç—å –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –º–∞—à–∏–Ω—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ BR-SRV (`sshuser` –∏ `root`) –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å –ø–∞—Ä—É –∏–∑ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ/–æ—Ç–∫—Ä—ã—Ç–æ–≥–æ RSA –∫–ª—é—á–∞. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π:

```shell
ssh-keygen -t rsa
```

 ![](attachments/e69980b1-2dd7-4977-a3f1-f7e36b63fb29.png)

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `/home/sshuser/.ssh` –∏–ª–∏ `/root/.ssh` –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã –∫–ª—é—á–µ–π:

```shell
ls -l ~/.ssh

  id_rsa  # –∑–∞–∫—Ä—ã—Ç—ã–π –∫–ª—é—á
  id_rsa.pub # –æ—Ç–∫—Ä—ã—Ç—ã–π –∫–ª—é—á
```

–ó–∞—Ö–æ–¥–∏–º –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `sshuser` –∏ `root` (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)

```shell
su - sshuser
```

–ö–æ–ø–∏—Ä—É–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–π SSH-–∫–ª—é—á –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `sshuser`: –ö–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `sshuser` –Ω–∞ HQ-SRV –ù–∞ HQ-SRV ssh –ø–æ—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω, —É–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ

```shell
ssh-copy-id -p 2024 sshuser@192.168.0.1
```

 ![](attachments/a3e7afec-6d1c-4efb-b9bd-85d14394401d.png)

–ö–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è user –Ω–∞ HQ-CLI

```shell
ssh-copy-id user@192.168.0.65
```

–ö–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è net_admin –Ω–∞ HQ-RTR

```shell
ssh-copy-id net_admin@172.16.4.1
```

–ö–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è net_admin –Ω–∞ BR-RTR

```shell
ssh-copy-id net_admin@172.16.5.1
```

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (hosts) 

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è `/etc/ansible/inv`

```shell
nano /etc/ansible/inv
```

–°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—á–∏—Å–ª—è—é—Ç—Å—è —Ö–æ—Å—Ç—ã.–ò–º–µ–Ω–∞ —Ö–æ—Å—Ç–æ–≤ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ IP.–ü–æ—Å–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ö–æ—Å—Ç–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ö–æ—Å—Ç—É –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É.

 ![](attachments/843e3363-fd37-4879-abfd-e29cbe8ffa10.png)


:::tip
**Yablochko076:**

> –ú–∞–ª–∞—è –ø—Ä–∞–≤–∫–∞ –∞–Ω—Å–∏–±–ª–∞
>
> –£ `net_admin` –∞–¥—Ä–µ—Å —Ç—É–Ω–µ–ª—è –ª—É—á—à–µ –ø–∏—Å–∞—Ç—å
>
> `10.5.5.1` –∏ `10.5.5.2`, –ø—Ä–∏–∫–æ–ø–∞—Ç—å—Å—è –º–æ–≥—É—Ç

:::

–ó–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º

```shell
ansible all -i /etc/ansible/inv -m ping
```

–ú–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ Python, –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —Ö–æ—Å—Ç–µ  ![](attachments/469e99f9-b917-44ec-ba42-8739347d4544.png)

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –º–∞—Å—à—Ç–∞–±–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ansible `/etc/ansible/ansible.cfg`

–í —Ä–∞–∑–¥–µ–ª–µ `[defaults]` –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∫–ª—é—á `interpreter_python` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `auto_silent`.

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–æ–≤ –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –≤—Ä—É—á–Ω—É—é:

```shell
nano /etc/ansible/ansible.cfg
```

```ini
[defaults]
interpreter_python=auto_silent
```

 ![](attachments/adc14c0e-1ba0-45d6-ad94-7150d8ffcb44.png)

–ü—Ä–æ–≤–µ—Ä—è–µ–º

```shell
ansible all -i /etc/ansible/inv -m ping
```

 ![](attachments/7e559a42-05aa-4278-8da9-2b02ab392184.png)

# 5. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ BR-SRV.

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ docker –∏ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É:

```shell
systemctl enable --now docker 
```


–ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π wiki –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –≤–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¶–£–° —Å–µ—Ä–≤–µ—Ä–∞! 

–ù–∞ HQ-CLI –æ—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä –≤ –≤–æ–¥–∏–º –∞–¥—Ä–µ—Å https://192.168.3.1 –≤–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å –æ—Ç `root` –∏ –∑–∞—Ö–æ–¥–∏–º –≤ –¶–£–° ![](attachments/c60d5cff-3990-4234-a1e4-282b33b0e15c.png)


–ù–∞–∂–∏–º–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ![](attachments/d11e27c3-a265-4fbf-b162-506bac686dbd.png)


–í—ã–±–∏—Ä–∞–µ–º —Ä–µ–∂–∏–º —ç–∫—Å–ø–µ—Ä—Ç–∞, –ø—Ä–∏–º–µ–Ω–∏—Ç—å ![](attachments/0bd96db7-b275-4fc1-850e-c9412ecbfa8f.png)


–í –º–µ–Ω—é –≤—ã–±–∏—Ä–∞–µ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. ![](attachments/06fc68a9-7314-487b-a679-e5721e6e78a5.png)


–ú–µ–Ω—è–µ–º –ø–æ—Ä—Ç –Ω–∞ 8081. ![](attachments/26eb086a-7e70-4512-887d-d783b277552a.png)

–ù–∞–∂–∏–º–∞–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å http-—Å–µ—Ä–≤–µ—Ä.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MediaWiki


–î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è `wiki.yml` –≤ –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –Ω–∞ HQ-CLI –ø–∏—à–µ–º `mediawiki docker-compose` ![](attachments/c615316f-31a3-4a81-863e-fb97b0e452cc.png)

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ.–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–∞—Ö–æ–¥–∏–º —Ä–∞–∑–¥–µ–ª "Adding a Database Server" –Ω–∞–∂–∏–º–∞–µ–º

 ![](attachments/8f224e97-f175-4cd5-9e2c-a843ea8ce1e2.png)

–í—ã–¥–µ–ª—è–µ–º –∫–æ–¥ –∏ –∫–æ–ø–∏—Ä—É–µ–º –µ–≥–æ

 ![](attachments/8d418c62-b6b9-4ea7-879b-7ddaed78fa5e.png)

–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–æ SSH –∫ BR-SRV —Å HQ-CLI.

```shell
ssh sshuser@192.168.3.1 -p 2024
```

 ![](attachments/c4e643d5-332c-4523-bac4-1863c0bc3a27.png) –∑–∞—Ö–æ–¥–∏–º –ø–æ–¥ root

```shell
su -
```

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª

```shell
nano ~/wiki.yml
```

–í–Ω–æ—Å–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª:

> –ü–æ—Ä—Ç: 8080
>
> –ò–º—è –≤—Ç–æ—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –µ–≥–æ –æ–±—Ä–∞–∑–∞: `mariadb`
>
> –ò–º—è –ë–î: `mediawiki`
>
> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î: `wiki` / `WikiP@ssw0rd`
>
> –ò–∑–º–µ–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä volumes (–ø—Ä–∞–≤–∏–º –ø—É—Ç—å)

```yml
services:
  wiki:
    image: mediawiki
    restart: always
    ports:
      - 8080:80
    links:
      - database
    volumes:
      - images:/var/www/html/images
      # - ./LocalSettings.php:/var/www/html/LocalSettings.php
  mariadb:
    image: mariadb
    restart: always
    environment:
      MYSQL_DATABASE: mediawiki
      MYSQL_USER: wiki
      MYSQL_PASSWORD: WikiP@ssw0rd
      MYSQL_RANDOM_ROOT_PASSWORD: 'yes'
    volumes:
      - dbvolume:/var/lib/mariadb

volumes:
  dbvolume:
    external: true
  images:
```

 ![](attachments/2d7b6302-114e-41a2-82f5-02f62de4fd30.png)

–ß—Ç–æ–±—ã –æ—Ç–¥–µ–ª—å–Ω—ã–π volume –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–º–µ–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è - —Å–æ–∑–¥–∞—ë–º –µ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ docker:

```shell
docker volume create dbvolume
```

> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∏–º–µ—é—â–∏–µ—Å—è volume –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π `docker volume ls`

–í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—É—Å–∫ —Å—Ç–µ–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º MediaWiki –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ wiki.yml:

```shell
docker compose -f wiki.yml up -d
```

–ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞

  ![](attachments/e12d2754-d7a2-427c-8670-a8d604f1f60b.png)

–û—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä –ø–æ –∞–¥—Ä–µ—Å—É –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ http://192.168.3.1:8080

–ù–∞–∂–∏–º–∞–µ–º `"set up the wiki"`, –ø—Ä–∏—Å—Ç—É–ø–∞–µ–º –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ.

 ![](attachments/4555b9ba-81ca-41cc-bac9-679687272377.png)

–í—ã–±–∏—Ä–∞–µ–º —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫, –¥–∞–ª–µ–µ

 ![](attachments/440df588-15c7-4ff9-89c1-bddc296aa90f.png)

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—É–Ω–∫—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ –Ω–∞–∂–∏–º–∞–µ–º –¥–∞–ª–µ–µ

 ![](attachments/12fcb5ff-ef06-4c42-a575-33b56f92ab0b.png)

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

> –•–æ—Å—Ç: `mariadb`
>
> –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä: `mediawiki`
>
> –£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å: `wiki` / `WikiP@ssw0rd`


–î–∞–ª–µ–µ

 ![](attachments/db2c101c-b2d7-468a-af07-110e22c12f26.png)

–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º, –¥–∞–ª–µ–µ

 ![](attachments/bdefb8ea-9c66-4e87-83e9-a6c097dc6cf3.png)

–ó–∞–¥–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

> –ù–∞–∑–≤–∞–Ω–∏–µ ‚Äî `DemoWiki`
>
> –£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Äî `wiki` / `WikiP@ssw0rd`
>
> –ê–¥—Ä–µ—Å ‚Äî `wiki@au-team.irpo`

–í—ã–±–∏—Ä–∞–µ–º –ø—É–Ω–∫—Ç `"—Ö–≤–∞—Ç–∏—Ç —É–∂–µ, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"`

–î–∞–ª–µ–µ ![](attachments/baf7d24b-82bf-48f7-8246-aa9c08109e45.png)


–ù–∞–∂–∏–º–∞–µ–º –¥–∞–ª–µ–µ ![](attachments/3d93c177-9daf-4f42-97be-73b1d92712d3.png)


–î–∞–ª–µ–µ ![](attachments/16df8a0f-39ee-46c7-8f37-d4dbf8a2ce77.png)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–µ—Ç—Å—è `LocalSettings.php`

 ![](attachments/a9e365cf-565a-4c40-8c90-c3f76b66d6e7.png)

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ–∞–π–ª `LocalSettings.php` —Å HQ-CLI –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```shell
scp user@192.168.0.65:~/–ó–∞–≥—Ä—É–∑–∫–∏/LocalSettings.php ./
```

–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Ñ–∞–π–ª–µ wiki.yml:

```shell
nano wiki.yml
```

```yml
volumes:
  - ./LocalSettings.php:/var/www/html/LocalSettings.php
```

 ![](attachments/d63ba5ec-afc0-4a52-a6f0-489a5f091f35.png)

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ docker-compose:

```shell
docker compose -f wiki.yml stop
```

```shell
docker compose -f wiki.yml up -d
```

 ![](attachments/c602eb79-ccfb-420f-a5ef-30ee24031ab0.png)

–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ Wiki http://192.168.3.2:8080  ![](attachments/9fa82bab-f62a-4686-ad9f-a23572a187f9.png)

# 6. –ù–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞—Ö —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –ø–æ—Ä—Ç–æ–≤

–ù–∞ BR-RTR –∏–∑–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–æ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `table inet nat`, –¥–æ–±–∞–≤–ª—è—è `chain prerouting`:

```javascript
chain prerouting {
	type nat hook prerouting priority filter; 
   	ip daddr 172.16.5.1 tcp dport 80 dnat ip to 192.168.3.1:8080
	ip daddr 172.16.5.1 tcp dport 22 dnat ip to 192.168.3.1:2222
}
```

 ![](attachments/50747853-f9bf-453c-a0cd-1cf67fa31b2e.png)

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º `nftables`!

```bash
systemctl restart nftables
```

–ù–∞ HQ-RTR –∏–∑–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–æ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `table inet nat`, –¥–æ–±–∞–≤–ª—è—è `chain prerouting`:

```nginx
chain prerouting {
  type nat hook prerouting priority filter; 
  ip daddr 172.16.4.1 tcp dport 22 dnat ip to 192.168.0.1:2222
}
```

 ![](attachments/44636d46-adfc-45af-a155-519b544719a0.png)

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º `nftables`!

```shell
systemctl restart nftables
```

# 7. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å moodle –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ HQ-SRV

–ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É:

```shell
systemctl enable --now httpd2
```

–í–∫–ª—é—á–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É MySQL:

```shell
systemctl enable --now mariadb
```

## –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ MySQL, —Å–æ–∑–¥–∞—ë–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

> * –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: `moodledb`
> * –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `moodle`
> * –ü–∞—Ä–æ–ª—å: `P@ssw0rd`

–ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å `mysql_secure_installation` (tab –Ω–∞ —ç—Ç–æ–º –ø—É–Ω–∫—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

* –ü–µ—Ä–≤—ã–π –ø—É–Ω–∫—Ç: `Enter`
* –í—Ç–æ—Ä–æ–π –ø—É–Ω–∫—Ç: `y`
* –¢—Ä–µ—Ç–∏–π –ø—É–Ω–∫—Ç: `n`
* –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É–Ω–∫—Ç—ã: `y`

 ![](attachments/04103f72-cc41-49b9-af25-105ca32e54eb.png)

–î–∞–ª–µ–µ –ø–∏—à–µ–º –∫–æ–º–∞–Ω–¥—É:

```shell
mysql -u root -p
```

–í–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å –æ—Ç root.  ![](attachments/bfa3522f-8fb1-4c0c-87c2-9c8f956bdb8b.png)

–°–æ–∑–¥–∞–µ–º –±–∞–∑—É (–º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤—Å–µ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ (–º–∞–ª–µ–Ω—å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏)):

```sql
CREATE DATABASE moodledb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'moodle'@'localhost' IDENTIFIED BY 'P@ssw0rd';
GRANT ALL PRIVILEGES ON moodledb.* TO 'moodle'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

 ![](attachments/c66397f0-2e31-40fd-9894-72bdaaec0241.png)

–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ Moodle:

```shell
git clone git://git.moodle.org/moodle.git
```

 ![](attachments/f4121c70-bca1-49a8-8370-4a82c618171e.png)

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ moodle:

```shell
cd moodle
```

–ò–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–∂–¥–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ–π –≤–µ—Ç–≤–∏:

```shell
git branch -a
```

 ![](attachments/139b9d61-55fe-4b64-ab3d-0e1647f758b4.png)

–°–æ–æ–±—â–∞–µ–º git, –∫–∞–∫—É—é –≤–µ—Ç–∫—É –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```shell
git branch --track MOODLE_405_STABLE origin/MOODLE_405_STABLE
```

–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–µ—Ç–∫—É —Å –Ω—É–∂–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π:

```shell
git checkout MOODLE_405_STABLE
```

 ![](attachments/424dd431-348c-4917-9269-f597518c8fea.png)

–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥:

```shell
cd
```

–ö–æ–ø–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ `/var/www/html/`:

```shell
cp -R moodle /var/www/html/
```

–°–æ–∑–¥–∞—ë–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Ä–∞–±–æ—Ç—ã Moodle:

```shell
mkdir /var/moodledata
```

–ù–∞–∑–Ω–∞—á–∞–µ–º –ø—Ä–∞–≤–∞:

```shell
chmod 777 /var/moodledata
chown -R apache2:apache2  /var/www/html/moodle
chmod -R 755 /var/www/html/moodle
```

–°–æ–∑–¥–∞–µ–º –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ Apache:

```shell
nano /etc/httpd2/conf/sites-available/moodle.conf
```

```markup
<VirtualHost *:80>
  ServerName au-team.irpo
  ServerAlias moodle.au-team.irpo
  DocumentRoot /var/www/html/moodle
  <Directory "var/www/html/moodle">
    AllowOverride ALL
    Options =Indexes FollowSymLinks
  </Directory>
</VirtualHost>
```

 ![](attachments/e516223a-d8cd-4435-abd1-d61494ef16af.png)

–°–æ–∑–¥–∞—ë–º —Å–∏–º–≤–æ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –∏–∑ `sites-available` –Ω–∞ `sites-enabled`:

```shell
ln -s /etc/httpd2/conf/sites-available/moodle.conf /etc/httpd2/conf/sites-enabled/
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ–∞–π–ª–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞:

```shell
apachectl configtest
```

 ![](attachments/05c56c15-2b4e-465c-9ed7-e3256b9df3f3.png)

–ü—Ä–∞–≤–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–∏–Ω—è—Ç—ã –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ. –î–ª—è —Ä–∞–±–æ—Ç—ã Moodle - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ 5000, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ php.ini –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000:

–ó–∞—Ö–æ–¥–∏–º –≤ –∫–æ–Ω—Ñ–∏–≥

```shell
nano /etc/php/8.1/apache2-mod_php/php.ini
```


\
–ù–∞–∂–∏–º–∞–µ–º `ctrl + _`–Ω–∞–±–∏—Ä–∞–µ–º ‚Ññ —Å—Ç—Ä–æ–∫–∏ `389`, –Ω–∞–∂–∏–º–∞–µ–º Enter–ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É `max_input_vars` –∏–∑–º–µ–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ:

* –£–±–∏—Ä–∞–µ–º —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ (`;`) –∏ —Å—Ç–∞–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ 5000

–°–æ—Ö—Ä–∞–Ω—è–µ–º `CTRL + O` –∏ –≤—ã—Ö–æ–¥–∏–º `CTRL + X`

 ![](attachments/7b1b5f23-7931-4e6d-8012-3ab2e4faef34.png)

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:

```shell
systemctl restart httpd2
```


–ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ hq-cli, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä –ø–∏—à–µ–º –¥–æ–º–µ–Ω –Ω–∞—à–µ–≥–æ —Å–∞–π—Ç–∞: http://au-team.irpo–ü–æ–ø–∞–¥–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ moodle. ![](attachments/fbec66b9-f631-47fa-ba7c-6d510a81b312.png)

–í—ã–±–∏—Ä–∞–µ–º —è–∑—ã–∫ —Ä—É—Å—Å–∫–∏–π, –Ω–∞–∂–∏–º–∞–µ–º –î–∞–ª–µ–µ.


–ò–∑–º–µ–Ω—è–µ–º –∫–∞—Ç–∞–ª–æ–≥ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ `/var/moodledata` –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ø—É—Ç–∏. ![](attachments/7a00de88-48e4-4f4b-991c-3e9b44193d6e.png)


–í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö mariadb, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º. ![](attachments/55ab8035-25e1-4f1a-9ed8-cbf21b0e47ea.png)


–í–Ω–æ—Å–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–∂–∏–º–∞–µ–º –î–∞–ª–µ–µ ![](attachments/535d9d75-4414-478d-9528-8476ead78089.png)


–ü—Ä–∏–Ω–∏–º–∞–µ–º –ª–∏—Ü–µ–Ω–∑–∏—é ![](attachments/f1f9fa40-b156-448b-9e37-85d965e70266.png)


–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–≤—Å–µ –æ–∫ - –∑–µ–ª–µ–Ω–æ–µ) –Ω–∞–∂–∏–º–∞–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å. ![](attachments/de9a8b0b-e6af-46e4-9a48-c6cff387ab60.png)


–ñ–¥–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –Ω–∞–∂–∏–º–∞–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å. ![](attachments/fb70cd6d-d24b-4451-8c3a-24c272a328cf.png)


–î–µ–ª–∞–µ–º –ø–µ—Ä–≤–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø–∞—Ä–æ–ª—å - `P@ssw0rd`, Email - `moodle@au-team.irpo`), –Ω–∞–∂–∏–º–∞–µ–º –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å. ![](attachments/4f739a8f-3384-4fb8-a789-b7507bafb680.png)


–í –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ —Å–∞–π—Ç–∞ –∑–∞–¥–∞–µ–º –Ω–æ–º–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞!! ![](attachments/4785608b-acfe-4b3a-b8eb-2c40eec2be43.png)


\
–ù–∞–∂–∏–º–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.–ó–∞–¥–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è–µ–º. ![](attachments/fa56081c-99bf-4b0e-9055-5f385580566b.png)

Moodle –Ω–∞—Å—Ç—Ä–æ–µ–Ω!

# 8.–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä nginx –∫–∞–∫ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –Ω–∞ HQ-RTR

–í—ã–∫–ª—é—á–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤–µ–± —Å–µ—Ä–≤–µ—Ä –∞–ª—å—Ç –ª–∏–Ω—É–∫—Å–∞!!!

```shell
systemctl disable ahtthd.service
systemctl stop ahtthd.service
```

–ó–∞–ø—É—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É

```shell
systemctl enable --now nginx
```

–û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Nginx

```shell
nano /etc/nginx/nginx.conf
```

–°–ø—É—Å–∫–∞–µ–º—Å—è –≤ –∫–æ–Ω–µ—Ü HTTP —Ç–∞–±–ª–∏—Ü—ã –∏ –ø–µ—Ä–µ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ñ–∏–≥—É—Ä–Ω–æ–π —Å–∫–æ–±–∫–æ–π `}` –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

```nginx
server {
  listen 80;
  server_name moodle.au-team.irpo;

  location / {
    proxy_pass http://192.168.0.1:80;
  }
}

server {
  listen 80;
  server_name wiki.au-team.irpo;

  location / {
    proxy_pass http://192.168.3.1:8080;
  }
}
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º Nginx

```shell
systemctl restart nginx
```

 ![](attachments/9e831c72-4482-4fd1-9cb7-6fdc261bf0fa.png)

# 9. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —è–Ω–¥–µ–∫—Å –±—Ä–∞—É–∑–µ—Ä –Ω–∞ CLI.

–ó–∞—Ö–æ–¥–∏–º –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –ø–æ–¥ root, –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:

```shell
su -
apt-get update
```

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–Ω–¥–µ–∫—Å –±—Ä–∞—É–∑–µ—Ä:

```shell
apt-get install yandex-browser-stable -y
```

 ![](attachments/1c65bafc-a2a1-4dfc-a5ff-fe1647c675ca.png)

–ó–∞—Ö–æ–¥–∏–º –≤ `–ú–µ–Ω—é` -> `–í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã` -> `–ò–Ω—Ç–µ—Ä–Ω–µ—Ç` -> `Yandex Browser` –ù–∞–∂–∏–º–∞–µ–º –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ -> `"–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª"`  ![](attachments/b0385468-ef96-4b0b-8ef5-40c45520658c.png)

–ì–æ—Ç–æ–≤–æ!!!


# –ë–õ–ê–ì–û–î–ê–†–ù–û–°–¢–ò

–ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –æ–±–Ω–∞—Ä—É–∂–∞—Ç —Å–ª—É–∂–∏—Ç–µ–ª–∏ –∫–æ–ª–ª–µ–¥–∂–∞ –ö–ü–ö –ú–ò–†–≠–ê –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤ —Å–ª–µ–¥—Å—Ç–≤–∏–∏ –ø—Ä–æ–±–ª–µ–º —É –ª—é–¥–µ–π, –æ –∫–æ—Ç–æ—Ä—ã—Ö –≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –≤ —ç—Ç–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ, –∏–º–µ–Ω–∞ –±—ã–ª–∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –º–Ω–æ–≥–∏–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –Ω–∏–∫–Ω–µ–π–º—ã.



:::tip
**–£–≤–∞–∂–∞–µ–º—ã–π Ramen!**


–•–æ—á—É –≤—ã—Ä–∞–∑–∏—Ç—å –í–∞–º –∏—Å–∫—Ä–µ–Ω–Ω—é—é –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–æ—Ü–µ–Ω–∏–º—É—é –ø–æ–º–æ—â—å –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏—Ö —É–∫–∞–∑–∞–Ω–∏–π –∫ –¥–µ–º–æ-—ç–∫–∑–∞–º–µ–Ω—É. 

–í–∞—à–∏ –∑–Ω–∞–Ω–∏—è –∏ –æ–ø—ã—Ç —Å—Ç–∞–ª–∏ –¥–ª—è –º–µ–Ω—è —Ü–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–æ–º, –∏ —è –æ—á–µ–Ω—å —Ü–µ–Ω—é –≤—Ä–µ–º—è –∏ —É—Å–∏–ª–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –í—ã –≤–ª–æ–∂–∏–ª–∏ –≤ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç.


–í–∞—à–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏—Ö —É–∫–∞–∑–∞–Ω–∏–π. –ë–ª–∞–≥–æ–¥–∞—Ä—è –í–∞—à–µ–º—É –≤–Ω–∏–º–∞–Ω–∏—é –∫ –¥–µ—Ç–∞–ª—è–º –∏ –≥–ª—É–±–æ–∫–æ–º—É –ø–æ–Ω–∏–º–∞–Ω–∏—é –ø—Ä–µ–¥–º–µ—Ç–∞, –º—ã —Å–º–æ–≥–ª–∏ —Å–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–µ–Ω –∫–∞–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º, —Ç–∞–∫ –∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º. –Ø –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏–∑–Ω–∞—Ç–µ–ª–µ–Ω –∑–∞ –í–∞—à—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º–∏ –∏–¥–µ—è–º–∏ –∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ –Ω–∞–º —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —ç–∫–∑–∞–º–µ–Ω–∞ –∏ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –±–æ–ª–µ–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º.


–í–∞—à –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º –∏ –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å –¥–µ–ª—É –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç –º–µ–Ω—è –∏ –º–æ–∏—Ö –∫–æ–ª–ª–µ–≥. –Ø –Ω–∞–¥–µ—é—Å—å –Ω–∞ –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ –∏ —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –≤–º–µ—Å—Ç–µ –º—ã —Å–º–æ–∂–µ–º –¥–æ—Å—Ç–∏—á—å –µ—â–µ –±–æ–ª—å—à–∏—Ö —É—Å–ø–µ—Ö–æ–≤.


**–ï—â–µ —Ä–∞–∑ —Å–ø–∞—Å–∏–±–æ –∑–∞ –í–∞—à—É –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –ø–æ–º–æ—â—å.**¬†

:::



:::tip
–•–æ—á—É –≤—ã—Ä–∞–∑–∏—Ç—å –æ–≥—Ä–æ–º–Ω—É—é –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –≤—Å–µ–π –∫–æ–º–∞–Ω–¥–µ **"–ú–∞–π—Å–∫–æ–π –†–µ–≤–æ–ª—é—Ü–∏–∏"**

–ò—Ö —Å–ø–ª–æ—á—ë–Ω–Ω–æ—Å—Ç—å –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª–∏–ª–∞ –º–Ω–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—É—é –º–µ—Ç–æ–¥–∏—á–∫—É.


–ë–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∏–º, –¥–∞–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –º–æ–∂–µ—Ç —Ä–∞–∑–≤–∏—Ç—å—Å—è –∏–∑ –æ–±—ã—á–Ω–æ–π —à–ø–∞—Ä–≥–∞–ª–∫–∏ –∫ –≠–∫–∑–∞–º–µ–Ω—É –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ —Å–∞–º–æ–º—É –î–ï–ú–û —ç–∫–∑–∞–º–µ–Ω—É!


ü•á–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–æ–ª–æ—Ç—ã—Ö —Å–ø–æ–Ω—Å–æ—Ä–æ–≤ –¥–∞–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ - –ú–∏–º–∏–º–∏—à–Ω–æ–≥–æ "**Ramen"** –∏ –£–º–Ω–µ–π—à–µ–≥–æ "**Hideyoshu"**!


üìù–¢–∞–∫–∂–µ –±–ª–∞–≥–æ–¥–∞—Ä—é –∏ —Ç–µ—Ö, –∫—Ç–æ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª –≤ —Å–±–æ—Ä–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ - –ú–æ—â–Ω—ã–π "**adsarf"**, –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π "**Yablochko076",** 


üéâ–ò –∑–∞ –º–æ—Ä–∞–ª—å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É - –ò–∑—ã—Å–∫–∞–Ω–Ω—ã–π "**W.R. D.R."**, –ê–Ω–∏–º–µ—à–Ω—ã–π "**Ozavrr**", –£–º–Ω–∞—è "**HastyaRe**", –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π "**cherni chayok**", –°–∫—Ä—ã—Ç–Ω—ã–π "**panpan**"


–í–∞—à –≤–µ—á–Ω—ã–π —Å–ª—É–≥–∞, ü•ï **DSvinka**

:::